<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consulta de Padrón</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div class="card shadow mx-auto" style="max-width: 500px;">
      <div class="card-body">
        <h1 class="card-title text-center h4 mb-4">Consulta de Padrón</h1>
        
        <div class="mb-3">
          <input type="text" id="nombreInput" class="form-control" placeholder="Escribe el nombre completo" />
        </div>
        <div class="d-grid">
          <button onclick="verificar()" class="btn btn-primary">Verificar</button>
        </div>

        <div id="resultado" class="alert mt-4 d-none" role="alert"></div>
      </div>
    </div>
  </div>

  <script>
    const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZymufO9zNb7XULXEt21mUWgytfrGsyV1c3tRRCLHJF5YxYRb75yiJc-lLfWajOI_27Y-olTwd9b7L/pub?gid=0&single=true&output=csv";

    function verificar() {
      const nombreBuscado = document.getElementById("nombreInput").value.trim().toLowerCase();
      const resultado = document.getElementById("resultado");
      resultado.className = "alert mt-4 d-block alert-info";
      resultado.innerText = "Buscando...";

      fetch(URL_CSV)
        .then(response => response.text())
        .then(data => {
          const filas = data.split("\n").map(row => row.split(","));
          const headers = filas[0].map(h => h.toLowerCase().trim());

          const nombreIndex = headers.findIndex(h => h.includes("nombre"));
          const sectorIndex = headers.findIndex(h => h.includes("sector") || h.includes("barrio"));
          const manzanaIndex = headers.findIndex(h => h.includes("manzana"));
          const loteIndex = headers.findIndex(h => h.includes("lote"));

          let encontrado = false;
          for (let i = 1; i < filas.length; i++) {
            const fila = filas[i];
            const nombre = fila[nombreIndex]?.trim().toLowerCase();
            if (nombre === nombreBuscado) {
              encontrado = true;
              const sector = fila[sectorIndex] || "No disponible";
              const manzana = fila[manzanaIndex] || "No disponible";
              const lote = fila[loteIndex] || "No disponible";

              resultado.className = "alert mt-4 d-block alert-success";
              resultado.innerHTML = `
                ✅ <strong>La persona se encuentra en el padrón.</strong><br>
                <strong>Sector / Barrio:</strong> ${sector}<br>
                <strong>Manzana:</strong> ${manzana}<br>
                <strong>Lote:</strong> ${lote}
              `;
              return;
            }
          }

          resultado.className = "alert mt-4 d-block alert-danger";
          resultado.innerHTML = "❌ La persona <strong>NO se encuentra</strong> en el padrón.";
        })
        .catch(error => {
          resultado.className = "alert mt-4 d-block alert-warning";
          resultado.innerText = "⚠️ Error al cargar el padrón.";
          console.error("Error:", error);
        });
    }
  </script>

</body>
</html>
